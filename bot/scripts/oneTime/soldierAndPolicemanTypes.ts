import { promiseSequence } from '../../utilities';
import { findTemplates, getTemplateKeyValueData, templateFromKeyValueData } from '../../wiki/newTemplateParser';
import WikiApi from '../../wiki/WikiApi';

const pages = [
  "זאב ז'בוטינסקי",
  'אהוד ברק',
  'רפאל איתן',
  'חיים הרצוג',
  'משה דיין',
  'עזר ויצמן',
  'שארל דה גול',
  'ויליאם בליי',
  'יעקב דורי',
  'דליה דורנר',
  'יגאל אלון',
  'מרדכי גור',
  'יובל נאמן',
  'הרמן גרינג',
  'יגאל ידין',
  'מרדכי מקלף',
  'בנימין בן אליעזר',
  "ג'יימס גרפילד",
  'חיים לסקוב',
  'צבי צור',
  'נחמן שי',
  'שאול מופז',
  "ג'ון ורקר, ויקונט גורט השישי",
  'דוד אלעזר',
  'משה לוי',
  'דן שומרון',
  'אמנון ליפקין-שחק',
  'משה יעלון',
  "גאורגי ז'וקוב",
  'יעקב טרנר',
  'שלמה להט',
  'פאול פון הינדנבורג',
  'ארתור ולסלי, הדוכס הראשון מוולינגטון',
  'לואי מאונטבאטן',
  'אפרים סנה',
  'אוליבר קרומוול',
  "צ'סטר ארתור",
  'עמרם מצנע',
  'אביגדור קהלני',
  'רון חולדאי',
  'מתן וילנאי',
  'אנרי פיליפ פטן',
  "צ'יאנג קאי שק",
  'צבי זמיר',
  'מאיר דגן',
  'דני חלוץ',
  'יצחק מרדכי',
  'עמי אילון',
  'הרברט פלומר',
  'ויליאם, נסיך ויילס',
  'ארתור ווקופ',
  'דני יתום',
  'הרצל בודינגר',
  'מירי רגב',
  'קרל הארבעה עשר, מלך שוודיה',
  'אריה אלדד',
  'רון כתרי',
  'משה קראדי',
  'יון אנטונסקו',
  'אהרן רמז',
  'אודי שני',
  'פרבז מושארף',
  'דורון אלמוג',
  'דוד קראוס',
  'שלמה אהרונישקי',
  'דוד צור',
  'אלעזר שטרן',
  'בני גנץ',
  'ישראל וייס',
  'אברהם יפה',
  'מתי פלד',
  'מאיר שמגר',
  'עוזי דיין',
  'מאיר זורע',
  'יהושע שגיא',
  'אביחי רונצקי',
  'אליעזר כהן',
  'יצחק בן ישראל',
  'סטלה לוי',
  'עמירה דותן',
  'רפי פלד',
  'יהודה וילק',
  'גד נבון',
  'מרדכי פירון',
  'מאיר עמית',
  'אלכסנדר הייג',
  "יצחק אהרונוביץ'",
  'מאיר פעיל',
  'עומר בראדלי',
  'אסף חפץ',
  'אודי אדם',
  'משה כרמל',
  'יואב גלנט',
  'אהרן יריב',
  'גדי איזנקוט',
  'גבי אשכנזי',
  'אמיר אשל',
  "ג'ון מקיין",
  'יונה רוזן',
  'דן הראל',
  'אביחי מנדלבליט',
  'יוסי פלד',
  'אילן בירן',
  'אורי אור',
  'אליהו לנקין',
  'אסעד אסעד',
  'רחבעם זאבי',
  'טל רוסו',
  'אהוד אבריאל',
  'עמר בר-לב',
  'מרדכי צפורי',
  'צבי בר',
  'משה פלד (חבר הכנסת)',
  'אריאל שרון',
  'מיקי לוי',
  'דודי כהן',
  'צבי ענבר',
  'פנחס בוכריס',
  'מוחמד זיא אל-חאק',
  'מרדכי בר-און',
  'אסתר דומיניסיני',
  'חזי לוי',
  'חנא חדד',
  'חי אדיב',
  'גיורא לב',
  'נחמן אש',
  "ג'ון ג'ליקו",
  'אלעד פלד',
  'דורון אביטל',
  'יאיר גולן',
  'אריה ביבי',
  'יצחק רבין',
  'הרצי הלוי',
  'אביב כוכבי',
  'לודוויג פון באטנברג',
  'איל בן ראובן',
  "הנסיך ג'ורג', דוכס קנט",
  'מרדכי גזית',
  'אילן הררי',
  'אייל זמיר',
  'בנצי סאו',
  'יוחנן דנינו',
  'משה מזרחי (חבר הכנסת)',
  'יואב סגלוביץ',
  'אחמד וחידי',
  'מאיר מיבר',
  "ג'וליאן בינג",
  'אפרים חירם',
  'דוד רשף',
  'קרל הראשון, קיסר אוסטריה',
  'יגאל סלוביק',
  'ברנרד פרגוסון',
  'נמרוד שפר',
  'אורנה ברביבאי',
  'אמנואלה פיליברטו, דוכס אאוסטה',
  'ויליאם סלים',
  'אמיר ברעם',
  'צבי גוב-ארי',
  'אריאל עמיעד',
  'אויגן, ארכידוכס אוסטריה',
  "הנסיך ג'ורג', דוכס קיימברידג'",
  'רונן מרלי',
  'עבד אל-פתאח א-סיסי',
  'חסן פירוזאבאדי',
  'מיכאל הרצוג',
  'ארנון אפק',
  'מוטי יוגב',
  'יוני שטבון',
  'משה אדרי (קצין משטרה)',
  'הנרי וושבורן',
  'אייל קרים',
  'אורי מנוס',
  'הרולד אלכסנדר, רוזן אלכסנדר הראשון מתוניס',
  'פטריס דה מק-מהון',
  'אלברכט, דוכס וירטמברג',
  'וילהלם, נסיך הכתר של גרמניה',
  'דוד זיני',
  'הארכידוכס קרל, דוכס טשן',
  'דני שחר',
  'רמי כהן',
  'סיימון פרייזר, לורד לובאט ה-15',
  'קובי שבתאי',
  'איתן גולן',
  'שמחה מעוז',
  'רוני מרום',
  "מעד'א חסבאני",
  'בזיל ברוק',
  'מופיד מרעי',
  "ג'ון גורטון",
  'רופרכט, נסיך הכתר של בוואריה',
  "אלכסנדר הור-רות'בן, ארל גאורי הראשון",
  "מייקל ג'פרי",
  'פיטר קוסגרוב',
  'ענת ברקו',
  "ג'ים וב",
  "ג'יימס מאטיס",
  'הרצל בוקר',
  'מרתה מקסאלי',
  'לאופולד, נסיך בוואריה',
  'הארכידוכס פרידריך, דוכס טשן',
  'יוזף פרדיננד, ארכידוכס אוסטריה',
  'יוזף אוגוסט, ארכידוכס אוסטריה',
  'רוני אלשיך',
  'פרידריך קרל, נסיך פרוסיה',
  'אלברט, מלך סקסוניה',
  "ג'רי מטפארה",
  'גאורג, מלך סקסוניה',
  'פרידריך אוגוסט השלישי, מלך סקסוניה',
  'לויד אוסטין',
  'שרון ניר',
  "ויליאם ג'רבויס",
  "צ'ארלס פרגוסון",
  'סיריל ניואול, ברון ניואול הראשון',
  'ברנרד פרייברג, ברון פרייברג הראשון',
  'וילוובי נורי, ברון נורי הראשון',
  'ארתור פוריט, ברון פוריט',
  'ארנולף, נסיך בוואריה',
  "ג'ון קלי",
  'רז שגיא',
  "ג'ק ברגמן",
  "קית' קלוג",
  'רונן מנליס',
  'הרברט ריימונד מקמאסטר',
  "אמיר עלי חאג'יזאדה",
  'גיליס בילט',
  'רוברט מולר',
  'פרדריק פון אוטר',
  'ארביד לינדמן',
  'הרולד ברוקלף',
  'אוגוסט, נסיך וירטמברג',
  'וילהלם קרל, דוכס אוראך',
  'אלפרד הראשון, נסיך וינדיש-גרץ',
  'פטר פרדיננד, ארכידוכס אוסטריה',
  'יצחק גזית',
  "רוני ג'קסון",
  "אלכסנדר קיימברידג', רוזן אתלון הראשון",
  "ז'ורז' ואניה",
  'שושי כחלון-כידור',
  "ג'ורג' גאולר",
  'איסכנדר מירזא',
  "יחיא ח'אן",
  'רון פרומר',
  'מתן כהנא',
  "עלי שמח'אני",
  'חוסיין סלאמי',
  'דייוויד הארלי',
  'ישראל גולדנשטיין',
  'הנרי דירבורן',
  'פיטר פורטר',
  "ל'רוי פופ ווקר",
  'ויליאם בלקנאפ',
  "ג'יימס מק'פרסון (מזכיר הצי)",
  'הוד בצר',
  'גורדון סאליבן',
  'תומאס וייט',
  "קנת' בריית'ווייט",
  'מריל מקפיק',
  'האוול קוב',
  "בנג'מין בריסטו",
  'אן לושאן',
  'לי יואנהונג',
  "אע'א מוחמד ח'אן קאג'אר",
  "באי צ'ונג-שי",
  'פנג דה-חואי',
  'רוברט נייפייר',
  'אגוסטין הראשון, קיסר מקסיקו',
  'ראמה החמישי, מלך תאילנד',
  'לין ביאו',
  'מא בופאנג',
  'רודולף שטגר-שטיינר פון שטיינשטטן',
  'פיליפ שרידן',
  'הנרי האלק',
  'נלסון מיילס',
  'יוסוף אל-עזמה',
  'הנסיך קאנין קוטוהיטו',
  'אלכס דן',
  'אסף צלאל',
  'ולטר ויבר',
  "חה יינג-צ'ין",
  'תומאס פיירפקס',
  'שונרוקו האטא',
  'ארתור פיליפ',
  "ג'ון הנטר",
  "צ'ן צ'נג",
  "יה ג'יין-יינג",
  "הג'ימה סוגיאמה",
  'צאו קון',
  'לכלן מקווארי',
  "תאנום קיטיקצ'ורן",
  'סריט תאנראט',
  'אחמד עלי אל-מאוואווי',
  'מוחמד נאדיר שאה, מלך אפגניסטן',
  "שיר עלי ח'אן, אמיר אפגניסטן",
  "איוב ח'אן, אמיר אפגניסטן",
  'פזל-אללה זאהדי',
  'פרננדו אלברס דה טולדו, הדוכס השלישי מאלבה',
  'אלסנדרו פארנזה, דוכס פארמה',
  "יאנקו ווקוטיץ'",
  "צ'ארלס דיוונס",
  'הנסיך פרדריק, דוכס יורק ואלבני',
  "ג'פרי אמהרסט, ברון אמהרסט הראשון",
  'פדריקו דה מונטפלטרו, דוכס אורבינו',
  'דני לוי',
  'פלגיוס הראשון, מלך אסטוריאס',
  'נירה שפק',
  'סמואל יאנג',
  'ויליאם וודס',
  'לוציוס למאר',
  'לאונרד ווד',
  'הנסיך ויליאם, דוכס קמברלנד',
  'אייזק שלבי',
  "ז'וזה מנדש קבסאדש",
  'מנואל גומש דה קושטה',
  "ג'ייקוב דולסון קוקס",
  'קארל שורץ',
  'המילטון פיש השלישי',
  'דנקן מקארתור',
  "ג'וזף עאון",
  "ג'ון אדייר",
  "צ'ארלס מרטין",
  'ויליאם סטון (מושל איווה)',
  "ריצ'רד אוגלסבי",
  'גיורא פורדס',
  'שאול כמיסה',
  "ג'וזף דשה",
  'קונרד בייקר',
  'אלווין פטרסון הובי',
  'קובי יעקובי',
  'לואי-אלכסנדר ברתייה',
  'עמוס טרטמן',
  'אדוארד אוניל',
  'ויליאם אוטס',
  'מוחמד אחמד סאדק',
  'פרנק קפריו',
  'עבאס כאמל',
  "דושאן סימוביץ'",
  'אברהם אבידן',
  "סיד מקמת'",
  'עבד א-רחים מוסאווי',
  'אמיר חאתמי',
  'סמואל אלברט',
  'צבי בן ארי (מפקד)',
  'עלי מחמוד עבאס',
  'תומאס רוגר',
  "ג'ון בראון גורדון",
  'ירון יצחק בן-נון',
  'מוחמד באקרי',
  "ג'ו פוס",
  "וולטר בדל סמית'",
  "לוציוס פיירצ'יילד",
  'קאדוואלדר וושברן',
  'פילימון דיקינסון',
  'פיליפ סקיילר',
  'תומאס סאמטר',
  'אולין ארל טיג',
  "ג'וליאן לרקום סליי",
  "ויליאם סמית' (מושל וירג'יניה)",
  'הנרי וייז',
  'הנרי ולס',
  "ג'יימס קמפר",
  'פרדריק הולידיי',
  'פיציו לי',
  'עלי עבדאללה איוב',
  'ויליאם בייט',
  'ויליאם פרסטון (פוליטיקאי מקנטקי)',
  "ג'ון בראון (מושל טנסי)",
  'אדמונד דייוויס',
  'לורנס סאליבן רוס',
  'מוחמד פאכפור',
  'חוסיין מוסאווי',
  "ז'ק ארז",
  'מוחמד כרמי',
  'פול אוקטב אבר',
  'הנרי ווטקינס אלן',
  "ג'ון טיילר מורגן",
  'רוברט סטוקטון',
  'אדלברט איימס',
  "אדוארד וולת'ול",
  'אמברוז ברנסייד',
  'ניקולאי האראלמביה',
];
const typeMapping = {
  חייל: 'צבאי',
  חיילת: 'צבאי',
  שוטר: 'משטרתי',
  שוטרת: 'משטרתי',
};

function getSummary(
  militaryCountMale: number,
  militaryCountFemale: number,
  policeCountMale: number,
  policeCountFemale: number,
) {
  let summary = 'שינוי שדה סיווג';
  if (militaryCountMale > 0) {
    summary += ', חייל -> צבאי';
  }
  if (militaryCountFemale > 0) {
    summary += ', חיילת -> צבאי';
  }
  if (policeCountMale > 0) {
    summary += ', שוטר -> משטרתי';
  }
  if (policeCountFemale > 0) {
    summary += ', שוטרת -> משטרתי';
  }
  return `${summary} (דיונים ב[[מיוחד:הבדל/42370063|בקשות מבעלי בוטים]] ו[[מיוחד:הבדל/42370027|אולם התבניות]])`;
}

export default async function soldierAndPolicemanTypes() {
  const api = WikiApi();
  await api.login();

  await promiseSequence(1, pages.map((page) => async () => {
    const { content, revid } = await api.articleContent(page);
    if (!content) {
      console.error('No content', page);
      return;
    }
    const templates = findTemplates(content, 'נושא משרה', page).concat(findTemplates(content, 'מנהיג', page));
    let newContent = content;
    let militaryCountMale = 0;
    let militaryCountFemale = 0;
    let policeCountMale = 0;
    let policeCountFemale = 0;
    for (const template of templates) {
      const isLeader = template.match(/^{{\s*מנהיג/);
      const templateName = isLeader ? 'מנהיג' : 'נושא משרה';
      const keyValueData = getTemplateKeyValueData(template);
      const oldType = keyValueData['סיווג'];
      const newType = typeMapping[oldType];
      if (newType) {
        keyValueData['סיווג'] = newType;
        newContent = newContent.replace(template, templateFromKeyValueData(keyValueData, templateName));
        if (oldType === 'חייל') {
          militaryCountMale += 1;
        } else if (oldType === 'חיילת') {
          militaryCountFemale += 1;
        } else if (oldType === 'שוטר') {
          policeCountMale += 1;
        } else if (oldType === 'שוטרת') {
          policeCountFemale += 1;
        }
      }
    }
    if (newContent !== content) {
      const summary = getSummary(militaryCountMale, militaryCountFemale, policeCountMale, policeCountFemale);
      await api.edit(page, summary, newContent, revid);
      console.log(page, 'updated');
    }
  }));
}
